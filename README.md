# flink-sql-executor
一个通用执行FlinkSQL的jar封装，实现快速FlinkSQL作业开发。复杂逻辑支持自定义算子代码 + SQL 的混合模式开发。

# 功能介绍
## 已实现
- 通用执行FlinkSQL的jar
- 读取SQL文件（sql注释有一定格式要求方便解析上下游关系）（SQL文件可放在resource目录，即jar中）
- SQL + 自定义算子模式：无法用SQL实现的逻辑可通过实现自定义算子接口，继而通过代码实现相关逻辑。
- 支持SQL参数变量。
- 支持SQL作业级别的状态过期时间配置。
- 支持UDF注册。


## 规划开发中
- 读取SQL文件远程目录。
- 系统更多参数配置开放。
- SQL校验。
- 作业开发时流图（开发时生成逻辑执行图，通过markdown格式打开可清晰看到作业节点之间关系）。
- SQL血缘。
- 其他。。。。

# 适用场景
- 实时计算较小的团队。
- 个人开发者。
- 不需要UI界面的SQL开发场景。

# 试用
参考example包下示例代码

建议：如果FlinkSQL作业规划较多，团队规模较大，需要多租户形式等，可参考开源项目如Dinky、StreamPark等

# SQL文件格式约定
格式说明：
- ！！！重要重要重要 "--#" 是当作下一条sql的注释。所有注释都应该用这样的格式。支持多行注释但都必须以此格式开头。
- 0. sql以";"结尾，建议单独一行。系统将以";"切分sql。
- 1. ddl_开头文件的sql会率先执行，故建议把source、sink等外部连接表的create sql在此文件中定义
- 2. 非ddl_开头的文件会根据sql顺序执行去构建流的graph
- 3. sql注释建议主动设置（如果是sql注释，如下说明可不显示注释，但系统会自动设置随机值，其中dependentTable会自动解析但准确性不能保证100%）
    - 3.1 tableName（必须）（作为临时表名，下一个算子可以直接读取，不支持中文），例如tableName=t1
    - 3.2 nodeName（可选）（作为SQL节点名，不支持中文）,例如 nodeName=n1
    - 3.3 dependentTable（建议）（依赖表名，用<>包裹）,例如 dependentTable=<t1>
    - 3.4 alias（可选）（sql别名）,例如 alias=a1
- 4. 自定义算子可以在sql文件中把自定义算子类全路径名当作sql，并建议显示设置第三点中的关键配置项（tableName、dependentTable）
- 5. 自定义算子包名必须以com开头
- 6. sql中读取变量通过${变量}方式
- 关于注释的保留字符：
    - 英文逗号","用于切分不同注释短语，从短语中提取关键注释信息；
    -  "="用于切分注释短语的关键词名和值；
    - 英文分号";"当作sql切分字符，不可在注释中出现